#!/usr/bin/awk -F, -f

# generated by: awk-csvalid https://github.com/tesera/awk-csvalid

# awk-csvalid csv toolset generator: https://github.com/tesera/awk-csvalid
# usage:
#    validate:     awk -f action=validate validator.awk > violations.txt
#    create table: awk -v action=table -f validator.awk | psql afgo_dev
#    sanitize csv: awk -v action=sanitize -f validator.awk > sanitized.csv
#    insert sql:   awk -v action=insert -f validator.awk | psql afgo_dev

# awk is a simple unix text file parser: http://www.gnu.org/software/gawk/manual/gawk.html
# awk primer:
#    NR = number/index current record
#    RS = record seperator new line i.e. \n
#    FS = field seperator i.e. ,
#    /pattern/ { expression } = if pattern is truthy run expression

BEGIN {
    FS=","; OFS=","; err_count=0; cats["na"]=0;
    if(!action) action = "validate"
    summary_header="file_name,field_name,rule,message,violation_count"
    CSVFILENAME = CSVFILENAME ? CSVFILENAME : FILENAME
    FPAT = "([^,]*)|(\"[^\"]+\")"
}

# builtin helper functions
function eql(x,y) {v=1; for (i in x) v=(v&&x[i]==y[i]); return v;}
function are_headers_valid(valid_headers) { v=0; split($0, h, ","); split(valid_headers, vh, "|"); return eql(h, vh); }
function is_unique(i, val) { if (vals[i,val]) { return 0; } else { vals[i,val] = 1; return 1; } }
function is_integer(x) { return x ~ /^-?[0-9]+$/ }
function is_number(x) { return x ~ /^-?[0-9]+.[0-9]+$/ }
function print_cats(categories) { for (category in categories) { if (categories[category]) print "      " category ": " categories[category]; } }
function log_err(cat) { cats[cat]++; err_count++; }


#get rid of the evil windows cr
{ sub("\r$", "") }


{
     for (i = 1; i <= NF; i++) {
         if (substr($i, 1, 1) == "\"") {
             len = length($i)
             $i = substr($i, 2, len - 2)
         }
     }
}


# make header index/map
NR > 1 {
field_width = 39
    company=$1
    company_plot_number=$2
    avi_version=$3
    polygon_number=$4
    year_photography=$5
    year_photo_call=$6
    layer_type=$7
    moist_reg=$8
    density=$9
    height=$10
    sp1=$11
    sp1_per=$12
    sp2=$13
    sp2_per=$14
    sp3=$15
    sp3_per=$16
    sp4=$17
    sp4_per=$18
    sp5=$19
    sp5_per=$20
    struc=$21
    struc_val=$22
    origin=$23
    tpr=$24
    initials=$25
    nfl=$26
    nfl_per=$27
    nat_non=$28
    anth_veg=$29
    anth_non=$30
    mod1=$31
    mod1_ext=$32
    mod1_yr=$33
    mod2=$34
    mod2_ext=$35
    mod2_yr=$36
    data=$37
    data_yr=$38
    photo_avi_layer_comment=$39
}

# awk rules based on user csv ruleset
NR == 1 && action == "validate" { headers="company|company_plot_number|avi_version|polygon_number|year_photography|year_photo_call|layer_type|moist_reg|density|height|sp1|sp1_per|sp2|sp2_per|sp3|sp3_per|sp4|sp4_per|sp5|sp5_per|struc|struc_val|origin|tpr|initials|nfl|nfl_per|nat_non|anth_veg|anth_non|mod1|mod1_ext|mod1_yr|mod2|mod2_ext|mod2_yr|data|data_yr|photo_avi_layer_comment"; if (!are_headers_valid(headers)) { gsub(/\|/, FS, headers); print  NR FS CSVFILENAME FS "header" FS "invalid-header" FS "error" FS  "headers are invalid "; exit 0;} }
NR == 1 && action == "validate:summary" { headers="company|company_plot_number|avi_version|polygon_number|year_photography|year_photo_call|layer_type|moist_reg|density|height|sp1|sp1_per|sp2|sp2_per|sp3|sp3_per|sp4|sp4_per|sp5|sp5_per|struc|struc_val|origin|tpr|initials|nfl|nfl_per|nat_non|anth_veg|anth_non|mod1|mod1_ext|mod1_yr|mod2|mod2_ext|mod2_yr|data|data_yr|photo_avi_layer_comment"; if (!are_headers_valid(headers)) { violations[CSVFILENAME FS "headers" FS  "names" FS "csv headers are invalid" FS "error"]=1; exit 0; } }
action ~ /validate/ && NR > 1 { pkey=company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type; if(keys[pkey]) { if (dupkeys[pkey]) dupkeys[pkey]++; else dupkeys[pkey] = 1 } else { keys[pkey] = NR } }
action == "validate" && NR > 1 && NF != field_width { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "invalid-column-count" FS "error" FS  "row " NR " has an invalid column count" FS ""} 
action == "validate:summary" && NR > 1 && NF != field_width { key=CSVFILENAME FS "" FS  "invalid-column-count" FS "row " NR " has an invalid column count" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && company == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "company value is required but was empty" FS "company"} 
action == "validate:summary" && NR > 1 && company == "" { key=CSVFILENAME FS "company" FS  "required" FS "company value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && company != "" && company !~ /^(AINS|ALPC|ANC|APLY|BLUE|CFPL|CFS|DAIS|FOFP|GOA|HPFP|HLFP|MDFP|MWWC|SFPI|SLPC|SPRA|SUND|TOLK|TOSL|UNKN|UOA|VAND|WFML|WYGP|WYPM)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "company value should match: /^(AINS|ALPC|ANC|APLY|BLUE|CFPL|CFS|DAIS|FOFP|GOA|HPFP|HLFP|MDFP|MWWC|SFPI|SLPC|SPRA|SUND|TOLK|TOSL|UNKN|UOA|VAND|WFML|WYGP|WYPM)$/" FS "company"} 
action == "validate:summary" && NR > 1 && company != "" && company !~ /^(AINS|ALPC|ANC|APLY|BLUE|CFPL|CFS|DAIS|FOFP|GOA|HPFP|HLFP|MDFP|MWWC|SFPI|SLPC|SPRA|SUND|TOLK|TOSL|UNKN|UOA|VAND|WFML|WYGP|WYPM)$/ { key=CSVFILENAME FS "company" FS  "pattern" FS "company value should match: /^(AINS|ALPC|ANC|APLY|BLUE|CFPL|CFS|DAIS|FOFP|GOA|HPFP|HLFP|MDFP|MWWC|SFPI|SLPC|SPRA|SUND|TOLK|TOSL|UNKN|UOA|VAND|WFML|WYGP|WYPM)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && company_plot_number == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "company_plot_number value is required but was empty" FS "company_plot_number"} 
action == "validate:summary" && NR > 1 && company_plot_number == "" { key=CSVFILENAME FS "company_plot_number" FS  "required" FS "company_plot_number value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && company_plot_number != "" && length(company_plot_number) > 15 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maxLength" FS "error" FS  "company_plot_number max length is: 15" FS "company_plot_number"} 
action == "validate:summary" && NR > 1 && company_plot_number != "" && length(company_plot_number) > 15 { key=CSVFILENAME FS "company_plot_number" FS  "maxLength" FS "company_plot_number max length is: 15" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && avi_version == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "avi_version value is required but was empty" FS "avi_version"} 
action == "validate:summary" && NR > 1 && avi_version == "" { key=CSVFILENAME FS "avi_version" FS  "required" FS "avi_version value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && avi_version != "" && avi_version !~ /^(AVI1\.0|AVI2\.1|AVI2\.1\.1|AVI2\.2)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "avi_version value should match: /^(AVI1\.0|AVI2\.1|AVI2\.1\.1|AVI2\.2)$/" FS "avi_version"} 
action == "validate:summary" && NR > 1 && avi_version != "" && avi_version !~ /^(AVI1\.0|AVI2\.1|AVI2\.1\.1|AVI2\.2)$/ { key=CSVFILENAME FS "avi_version" FS  "pattern" FS "avi_version value should match: /^(AVI1\.0|AVI2\.1|AVI2\.1\.1|AVI2\.2)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && polygon_number && !is_integer(polygon_number) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "polygon_number should be an integer" FS "polygon_number"} 
action == "validate:summary" && NR > 1 && polygon_number && !is_integer(polygon_number) { key=CSVFILENAME FS "polygon_number" FS  "type" FS "polygon_number should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && polygon_number == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "polygon_number value is required but was empty" FS "polygon_number"} 
action == "validate:summary" && NR > 1 && polygon_number == "" { key=CSVFILENAME FS "polygon_number" FS  "required" FS "polygon_number value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && polygon_number != "" && polygon_number < 1 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "minimum" FS "error" FS  "polygon_number value should be greater or equal to: 1" FS "polygon_number"} 
action == "validate:summary" && NR > 1 && polygon_number != "" && polygon_number < 1 { key=CSVFILENAME FS "polygon_number" FS  "minimum" FS "polygon_number value should be greater or equal to: 1" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && polygon_number != "" && polygon_number > 9999999999 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maximum" FS "error" FS  "polygon_number value should be less or equal to: 9999999999" FS "polygon_number"} 
action == "validate:summary" && NR > 1 && polygon_number != "" && polygon_number > 9999999999 { key=CSVFILENAME FS "polygon_number" FS  "maximum" FS "polygon_number value should be less or equal to: 9999999999" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && year_photography && !is_integer(year_photography) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "year_photography should be an integer" FS "year_photography"} 
action == "validate:summary" && NR > 1 && year_photography && !is_integer(year_photography) { key=CSVFILENAME FS "year_photography" FS  "type" FS "year_photography should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && year_photography == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "year_photography value is required but was empty" FS "year_photography"} 
action == "validate:summary" && NR > 1 && year_photography == "" { key=CSVFILENAME FS "year_photography" FS  "required" FS "year_photography value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && year_photography != "" && year_photography < 1900 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "minimum" FS "error" FS  "year_photography value should be greater or equal to: 1900" FS "year_photography"} 
action == "validate:summary" && NR > 1 && year_photography != "" && year_photography < 1900 { key=CSVFILENAME FS "year_photography" FS  "minimum" FS "year_photography value should be greater or equal to: 1900" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && year_photography != "" && year_photography > 2050 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maximum" FS "error" FS  "year_photography value should be less or equal to: 2050" FS "year_photography"} 
action == "validate:summary" && NR > 1 && year_photography != "" && year_photography > 2050 { key=CSVFILENAME FS "year_photography" FS  "maximum" FS "year_photography value should be less or equal to: 2050" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && year_photo_call && !is_integer(year_photo_call) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "year_photo_call should be an integer" FS "year_photo_call"} 
action == "validate:summary" && NR > 1 && year_photo_call && !is_integer(year_photo_call) { key=CSVFILENAME FS "year_photo_call" FS  "type" FS "year_photo_call should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && year_photo_call != "" && year_photo_call < 1900 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "minimum" FS "error" FS  "year_photo_call value should be greater or equal to: 1900" FS "year_photo_call"} 
action == "validate:summary" && NR > 1 && year_photo_call != "" && year_photo_call < 1900 { key=CSVFILENAME FS "year_photo_call" FS  "minimum" FS "year_photo_call value should be greater or equal to: 1900" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && year_photo_call != "" && year_photo_call > 2050 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maximum" FS "error" FS  "year_photo_call value should be less or equal to: 2050" FS "year_photo_call"} 
action == "validate:summary" && NR > 1 && year_photo_call != "" && year_photo_call > 2050 { key=CSVFILENAME FS "year_photo_call" FS  "maximum" FS "year_photo_call value should be less or equal to: 2050" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && layer_type && !is_integer(layer_type) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "layer_type should be an integer" FS "layer_type"} 
action == "validate:summary" && NR > 1 && layer_type && !is_integer(layer_type) { key=CSVFILENAME FS "layer_type" FS  "type" FS "layer_type should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && layer_type == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "layer_type value is required but was empty" FS "layer_type"} 
action == "validate:summary" && NR > 1 && layer_type == "" { key=CSVFILENAME FS "layer_type" FS  "required" FS "layer_type value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && layer_type != "" && layer_type !~ /^(1|2|3|4|5)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "layer_type value should match: /^(1|2|3|4|5)$/" FS "layer_type"} 
action == "validate:summary" && NR > 1 && layer_type != "" && layer_type !~ /^(1|2|3|4|5)$/ { key=CSVFILENAME FS "layer_type" FS  "pattern" FS "layer_type value should match: /^(1|2|3|4|5)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && moist_reg == "" { log_err("warning"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "warning" FS  "moist_reg value is required but was empty" FS "moist_reg"} 
action == "validate:summary" && NR > 1 && moist_reg == "" { key=CSVFILENAME FS "moist_reg" FS  "required" FS "moist_reg value is required but was empty" FS "warning"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && moist_reg != "" && moist_reg !~ /^(d|m|w|a)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "moist_reg value should match: /^(d|m|w|a)$/" FS "moist_reg"} 
action == "validate:summary" && NR > 1 && moist_reg != "" && moist_reg !~ /^(d|m|w|a)$/ { key=CSVFILENAME FS "moist_reg" FS  "pattern" FS "moist_reg value should match: /^(d|m|w|a)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && density != "" && density !~ /^(A|B|C|D)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "density value should match: /^(A|B|C|D)$/" FS "density"} 
action == "validate:summary" && NR > 1 && density != "" && density !~ /^(A|B|C|D)$/ { key=CSVFILENAME FS "density" FS  "pattern" FS "density value should match: /^(A|B|C|D)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && height && !is_integer(height) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "height should be an integer" FS "height"} 
action == "validate:summary" && NR > 1 && height && !is_integer(height) { key=CSVFILENAME FS "height" FS  "type" FS "height should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && height == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "height value is required but was empty" FS "height"} 
action == "validate:summary" && NR > 1 && height == "" { key=CSVFILENAME FS "height" FS  "required" FS "height value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && height != "" && height < 0 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "minimum" FS "error" FS  "height value should be greater or equal to: 0" FS "height"} 
action == "validate:summary" && NR > 1 && height != "" && height < 0 { key=CSVFILENAME FS "height" FS  "minimum" FS "height value should be greater or equal to: 0" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && height != "" && height > 50 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maximum" FS "error" FS  "height value should be less or equal to: 50" FS "height"} 
action == "validate:summary" && NR > 1 && height != "" && height > 50 { key=CSVFILENAME FS "height" FS  "maximum" FS "height value should be less or equal to: 50" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp1 == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "sp1 value is required but was empty" FS "sp1"} 
action == "validate:summary" && NR > 1 && sp1 == "" { key=CSVFILENAME FS "sp1" FS  "required" FS "sp1 value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp1 != "" && sp1 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp1 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "sp1"} 
action == "validate:summary" && NR > 1 && sp1 != "" && sp1 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { key=CSVFILENAME FS "sp1" FS  "pattern" FS "sp1 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp1_per && !is_integer(sp1_per) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "sp1_per should be an integer" FS "sp1_per"} 
action == "validate:summary" && NR > 1 && sp1_per && !is_integer(sp1_per) { key=CSVFILENAME FS "sp1_per" FS  "type" FS "sp1_per should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp1_per == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "sp1_per value is required but was empty" FS "sp1_per"} 
action == "validate:summary" && NR > 1 && sp1_per == "" { key=CSVFILENAME FS "sp1_per" FS  "required" FS "sp1_per value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp1_per != "" && sp1_per !~ /^(0|2|3|4|5|6|7|8|9|10)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp1_per value should match: /^(0|2|3|4|5|6|7|8|9|10)$/" FS "sp1_per"} 
action == "validate:summary" && NR > 1 && sp1_per != "" && sp1_per !~ /^(0|2|3|4|5|6|7|8|9|10)$/ { key=CSVFILENAME FS "sp1_per" FS  "pattern" FS "sp1_per value should match: /^(0|2|3|4|5|6|7|8|9|10)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp2 != "" && sp2 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp2 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "sp2"} 
action == "validate:summary" && NR > 1 && sp2 != "" && sp2 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { key=CSVFILENAME FS "sp2" FS  "pattern" FS "sp2 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp2_per && !is_integer(sp2_per) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "sp2_per should be an integer" FS "sp2_per"} 
action == "validate:summary" && NR > 1 && sp2_per && !is_integer(sp2_per) { key=CSVFILENAME FS "sp2_per" FS  "type" FS "sp2_per should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp2_per == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "sp2_per value is required but was empty" FS "sp2_per"} 
action == "validate:summary" && NR > 1 && sp2_per == "" { key=CSVFILENAME FS "sp2_per" FS  "required" FS "sp2_per value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp2_per != "" && sp2_per !~ /^(0|1|2|3|4|5)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp2_per value should match: /^(0|1|2|3|4|5)$/" FS "sp2_per"} 
action == "validate:summary" && NR > 1 && sp2_per != "" && sp2_per !~ /^(0|1|2|3|4|5)$/ { key=CSVFILENAME FS "sp2_per" FS  "pattern" FS "sp2_per value should match: /^(0|1|2|3|4|5)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp3 != "" && sp3 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp3 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "sp3"} 
action == "validate:summary" && NR > 1 && sp3 != "" && sp3 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { key=CSVFILENAME FS "sp3" FS  "pattern" FS "sp3 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp3_per && !is_integer(sp3_per) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "sp3_per should be an integer" FS "sp3_per"} 
action == "validate:summary" && NR > 1 && sp3_per && !is_integer(sp3_per) { key=CSVFILENAME FS "sp3_per" FS  "type" FS "sp3_per should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp3_per == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "sp3_per value is required but was empty" FS "sp3_per"} 
action == "validate:summary" && NR > 1 && sp3_per == "" { key=CSVFILENAME FS "sp3_per" FS  "required" FS "sp3_per value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp3_per != "" && sp3_per !~ /^(0|1|2|3)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp3_per value should match: /^(0|1|2|3)$/" FS "sp3_per"} 
action == "validate:summary" && NR > 1 && sp3_per != "" && sp3_per !~ /^(0|1|2|3)$/ { key=CSVFILENAME FS "sp3_per" FS  "pattern" FS "sp3_per value should match: /^(0|1|2|3)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp4 != "" && sp4 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp4 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "sp4"} 
action == "validate:summary" && NR > 1 && sp4 != "" && sp4 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { key=CSVFILENAME FS "sp4" FS  "pattern" FS "sp4 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp4_per && !is_integer(sp4_per) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "sp4_per should be an integer" FS "sp4_per"} 
action == "validate:summary" && NR > 1 && sp4_per && !is_integer(sp4_per) { key=CSVFILENAME FS "sp4_per" FS  "type" FS "sp4_per should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp4_per == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "sp4_per value is required but was empty" FS "sp4_per"} 
action == "validate:summary" && NR > 1 && sp4_per == "" { key=CSVFILENAME FS "sp4_per" FS  "required" FS "sp4_per value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp4_per != "" && sp4_per !~ /^(0|1|2)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp4_per value should match: /^(0|1|2)$/" FS "sp4_per"} 
action == "validate:summary" && NR > 1 && sp4_per != "" && sp4_per !~ /^(0|1|2)$/ { key=CSVFILENAME FS "sp4_per" FS  "pattern" FS "sp4_per value should match: /^(0|1|2)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp5 != "" && sp5 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp5 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "sp5"} 
action == "validate:summary" && NR > 1 && sp5 != "" && sp5 !~ /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/ { key=CSVFILENAME FS "sp5" FS  "pattern" FS "sp5 value should match: /^(A|Aw|Ax|Bw|Fa|Fb|Fd|La|Ls|Lt|Lw|P|Pa|Pb|Pf|Pj|Pl|Pw|Px|Sb|Se|Sw|Sx|No)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp5_per && !is_integer(sp5_per) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "sp5_per should be an integer" FS "sp5_per"} 
action == "validate:summary" && NR > 1 && sp5_per && !is_integer(sp5_per) { key=CSVFILENAME FS "sp5_per" FS  "type" FS "sp5_per should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp5_per == "" { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "required" FS "error" FS  "sp5_per value is required but was empty" FS "sp5_per"} 
action == "validate:summary" && NR > 1 && sp5_per == "" { key=CSVFILENAME FS "sp5_per" FS  "required" FS "sp5_per value is required but was empty" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && sp5_per != "" && sp5_per !~ /^(0|1|2)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "sp5_per value should match: /^(0|1|2)$/" FS "sp5_per"} 
action == "validate:summary" && NR > 1 && sp5_per != "" && sp5_per !~ /^(0|1|2)$/ { key=CSVFILENAME FS "sp5_per" FS  "pattern" FS "sp5_per value should match: /^(0|1|2)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && struc != "" && struc !~ /^(C|H|M|S)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "struc value should match: /^(C|H|M|S)$/" FS "struc"} 
action == "validate:summary" && NR > 1 && struc != "" && struc !~ /^(C|H|M|S)$/ { key=CSVFILENAME FS "struc" FS  "pattern" FS "struc value should match: /^(C|H|M|S)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && struc_val && !is_integer(struc_val) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "struc_val should be an integer" FS "struc_val"} 
action == "validate:summary" && NR > 1 && struc_val && !is_integer(struc_val) { key=CSVFILENAME FS "struc_val" FS  "type" FS "struc_val should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && struc_val != "" && struc_val !~ /^(0|1|2|3|4|5|6|7|8|9)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "struc_val value should match: /^(0|1|2|3|4|5|6|7|8|9)$/" FS "struc_val"} 
action == "validate:summary" && NR > 1 && struc_val != "" && struc_val !~ /^(0|1|2|3|4|5|6|7|8|9)$/ { key=CSVFILENAME FS "struc_val" FS  "pattern" FS "struc_val value should match: /^(0|1|2|3|4|5|6|7|8|9)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && origin && !is_integer(origin) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "origin should be an integer" FS "origin"} 
action == "validate:summary" && NR > 1 && origin && !is_integer(origin) { key=CSVFILENAME FS "origin" FS  "type" FS "origin should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && origin != "" && origin < 0 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "minimum" FS "error" FS  "origin value should be greater or equal to: 0" FS "origin"} 
action == "validate:summary" && NR > 1 && origin != "" && origin < 0 { key=CSVFILENAME FS "origin" FS  "minimum" FS "origin value should be greater or equal to: 0" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && origin != "" && origin > 2050 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maximum" FS "error" FS  "origin value should be less or equal to: 2050" FS "origin"} 
action == "validate:summary" && NR > 1 && origin != "" && origin > 2050 { key=CSVFILENAME FS "origin" FS  "maximum" FS "origin value should be less or equal to: 2050" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && tpr != "" && tpr !~ /^(F|G|M|U)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "tpr value should match: /^(F|G|M|U)$/" FS "tpr"} 
action == "validate:summary" && NR > 1 && tpr != "" && tpr !~ /^(F|G|M|U)$/ { key=CSVFILENAME FS "tpr" FS  "pattern" FS "tpr value should match: /^(F|G|M|U)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && initials != "" && length(initials) > 2 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maxLength" FS "error" FS  "initials max length is: 2" FS "initials"} 
action == "validate:summary" && NR > 1 && initials != "" && length(initials) > 2 { key=CSVFILENAME FS "initials" FS  "maxLength" FS "initials max length is: 2" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && nfl != "" && nfl !~ /^(BR|HF|HG|SC|SO)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "nfl value should match: /^(BR|HF|HG|SC|SO)$/" FS "nfl"} 
action == "validate:summary" && NR > 1 && nfl != "" && nfl !~ /^(BR|HF|HG|SC|SO)$/ { key=CSVFILENAME FS "nfl" FS  "pattern" FS "nfl value should match: /^(BR|HF|HG|SC|SO)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && nfl_per != "" && nfl_per !~ /^(0|1|2|3|4|5|6|7|8|9|10)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "nfl_per value should match: /^(0|1|2|3|4|5|6|7|8|9|10)$/" FS "nfl_per"} 
action == "validate:summary" && NR > 1 && nfl_per != "" && nfl_per !~ /^(0|1|2|3|4|5|6|7|8|9|10)$/ { key=CSVFILENAME FS "nfl_per" FS  "pattern" FS "nfl_per value should match: /^(0|1|2|3|4|5|6|7|8|9|10)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && nat_non != "" && nat_non !~ /^(NMB|NMC|NMR|NMS|NWF|NWI|NWL|NWR)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "nat_non value should match: /^(NMB|NMC|NMR|NMS|NWF|NWI|NWL|NWR)$/" FS "nat_non"} 
action == "validate:summary" && NR > 1 && nat_non != "" && nat_non !~ /^(NMB|NMC|NMR|NMS|NWF|NWI|NWL|NWR)$/ { key=CSVFILENAME FS "nat_non" FS  "pattern" FS "nat_non value should match: /^(NMB|NMC|NMR|NMS|NWF|NWI|NWL|NWR)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && anth_veg != "" && anth_veg !~ /^(CA|CP|CPR|CIP|CIW)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "anth_veg value should match: /^(CA|CP|CPR|CIP|CIW)$/" FS "anth_veg"} 
action == "validate:summary" && NR > 1 && anth_veg != "" && anth_veg !~ /^(CA|CP|CPR|CIP|CIW)$/ { key=CSVFILENAME FS "anth_veg" FS  "pattern" FS "anth_veg value should match: /^(CA|CP|CPR|CIP|CIW)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && anth_non != "" && anth_non !~ /^(ASC|ASR|AIH|AIE|AIG|AIF|AIM|AII)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "anth_non value should match: /^(ASC|ASR|AIH|AIE|AIG|AIF|AIM|AII)$/" FS "anth_non"} 
action == "validate:summary" && NR > 1 && anth_non != "" && anth_non !~ /^(ASC|ASR|AIH|AIE|AIG|AIF|AIM|AII)$/ { key=CSVFILENAME FS "anth_non" FS  "pattern" FS "anth_non value should match: /^(ASC|ASR|AIH|AIE|AIG|AIF|AIM|AII)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod1 != "" && mod1 !~ /^(BT|BU|CC|CL|DI|DT|GR|IK|IR|PL|SC|SI|SN|ST|TH|WE|WF|UK)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "mod1 value should match: /^(BT|BU|CC|CL|DI|DT|GR|IK|IR|PL|SC|SI|SN|ST|TH|WE|WF|UK)$/" FS "mod1"} 
action == "validate:summary" && NR > 1 && mod1 != "" && mod1 !~ /^(BT|BU|CC|CL|DI|DT|GR|IK|IR|PL|SC|SI|SN|ST|TH|WE|WF|UK)$/ { key=CSVFILENAME FS "mod1" FS  "pattern" FS "mod1 value should match: /^(BT|BU|CC|CL|DI|DT|GR|IK|IR|PL|SC|SI|SN|ST|TH|WE|WF|UK)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod1_ext != "" && mod1_ext !~ /^(0|1|2|3|4|5)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "mod1_ext value should match: /^(0|1|2|3|4|5)$/" FS "mod1_ext"} 
action == "validate:summary" && NR > 1 && mod1_ext != "" && mod1_ext !~ /^(0|1|2|3|4|5)$/ { key=CSVFILENAME FS "mod1_ext" FS  "pattern" FS "mod1_ext value should match: /^(0|1|2|3|4|5)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod1_yr && !is_integer(mod1_yr) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "mod1_yr should be an integer" FS "mod1_yr"} 
action == "validate:summary" && NR > 1 && mod1_yr && !is_integer(mod1_yr) { key=CSVFILENAME FS "mod1_yr" FS  "type" FS "mod1_yr should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod1_yr != "" && mod1_yr < 0 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "minimum" FS "error" FS  "mod1_yr value should be greater or equal to: 0" FS "mod1_yr"} 
action == "validate:summary" && NR > 1 && mod1_yr != "" && mod1_yr < 0 { key=CSVFILENAME FS "mod1_yr" FS  "minimum" FS "mod1_yr value should be greater or equal to: 0" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod1_yr != "" && mod1_yr > 2050 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maximum" FS "error" FS  "mod1_yr value should be less or equal to: 2050" FS "mod1_yr"} 
action == "validate:summary" && NR > 1 && mod1_yr != "" && mod1_yr > 2050 { key=CSVFILENAME FS "mod1_yr" FS  "maximum" FS "mod1_yr value should be less or equal to: 2050" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod2 != "" && mod2 !~ /^(BT|BU|CC|CL|DI|DT|GR|IK|IR|PL|SC|SI|SN|ST|TH|WE|WF|UK)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "mod2 value should match: /^(BT|BU|CC|CL|DI|DT|GR|IK|IR|PL|SC|SI|SN|ST|TH|WE|WF|UK)$/" FS "mod2"} 
action == "validate:summary" && NR > 1 && mod2 != "" && mod2 !~ /^(BT|BU|CC|CL|DI|DT|GR|IK|IR|PL|SC|SI|SN|ST|TH|WE|WF|UK)$/ { key=CSVFILENAME FS "mod2" FS  "pattern" FS "mod2 value should match: /^(BT|BU|CC|CL|DI|DT|GR|IK|IR|PL|SC|SI|SN|ST|TH|WE|WF|UK)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod2_ext != "" && mod2_ext !~ /^(0|1|2|3|4|5)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "mod2_ext value should match: /^(0|1|2|3|4|5)$/" FS "mod2_ext"} 
action == "validate:summary" && NR > 1 && mod2_ext != "" && mod2_ext !~ /^(0|1|2|3|4|5)$/ { key=CSVFILENAME FS "mod2_ext" FS  "pattern" FS "mod2_ext value should match: /^(0|1|2|3|4|5)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod2_yr && !is_integer(mod2_yr) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "mod2_yr should be an integer" FS "mod2_yr"} 
action == "validate:summary" && NR > 1 && mod2_yr && !is_integer(mod2_yr) { key=CSVFILENAME FS "mod2_yr" FS  "type" FS "mod2_yr should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod2_yr != "" && mod2_yr < 0 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "minimum" FS "error" FS  "mod2_yr value should be greater or equal to: 0" FS "mod2_yr"} 
action == "validate:summary" && NR > 1 && mod2_yr != "" && mod2_yr < 0 { key=CSVFILENAME FS "mod2_yr" FS  "minimum" FS "mod2_yr value should be greater or equal to: 0" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && mod2_yr != "" && mod2_yr > 2050 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maximum" FS "error" FS  "mod2_yr value should be less or equal to: 2050" FS "mod2_yr"} 
action == "validate:summary" && NR > 1 && mod2_yr != "" && mod2_yr > 2050 { key=CSVFILENAME FS "mod2_yr" FS  "maximum" FS "mod2_yr value should be less or equal to: 2050" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && data != "" && data !~ /^(A|C|F|I|L|P|S|V)$/ { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "pattern" FS "error" FS  "data value should match: /^(A|C|F|I|L|P|S|V)$/" FS "data"} 
action == "validate:summary" && NR > 1 && data != "" && data !~ /^(A|C|F|I|L|P|S|V)$/ { key=CSVFILENAME FS "data" FS  "pattern" FS "data value should match: /^(A|C|F|I|L|P|S|V)$/" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && data_yr && !is_integer(data_yr) { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "type" FS "error" FS  "data_yr should be an integer" FS "data_yr"} 
action == "validate:summary" && NR > 1 && data_yr && !is_integer(data_yr) { key=CSVFILENAME FS "data_yr" FS  "type" FS "data_yr should be an integer" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && data_yr != "" && data_yr < 0 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "minimum" FS "error" FS  "data_yr value should be greater or equal to: 0" FS "data_yr"} 
action == "validate:summary" && NR > 1 && data_yr != "" && data_yr < 0 { key=CSVFILENAME FS "data_yr" FS  "minimum" FS "data_yr value should be greater or equal to: 0" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && data_yr != "" && data_yr > 2050 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maximum" FS "error" FS  "data_yr value should be less or equal to: 2050" FS "data_yr"} 
action == "validate:summary" && NR > 1 && data_yr != "" && data_yr > 2050 { key=CSVFILENAME FS "data_yr" FS  "maximum" FS "data_yr value should be less or equal to: 2050" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 
action == "validate" && NR > 1 && photo_avi_layer_comment != "" && length(photo_avi_layer_comment) > 250 { log_err("error"); print  NR FS CSVFILENAME FS company "-" company_plot_number "-" polygon_number "-" year_photography "-" layer_type FS "maxLength" FS "error" FS  "photo_avi_layer_comment max length is: 250" FS "photo_avi_layer_comment"} 
action == "validate:summary" && NR > 1 && photo_avi_layer_comment != "" && length(photo_avi_layer_comment) > 250 { key=CSVFILENAME FS "photo_avi_layer_comment" FS  "maxLength" FS "photo_avi_layer_comment max length is: 250" FS "error"; if(!violations[key]) { violations[key]=0; } violations[key]++; } 

# sanitize rules
action ~ /^(sanitize|insert)$/ && NR > 1 {
    if (sp1_per == "") $12 = "\\N"
    if (origin == "") $23 = "\\N"
    if (mod2_ext == "") $35 = "\\N"
    if (nat_non == "") $28 = "\\N"
    if (initials == "") $25 = "\\N"
    if (photo_avi_layer_comment == "") $39 = "\\N"
    if (sp2_per == "") $14 = "\\N"
    if (avi_version == "") $3 = "\\N"
    if (data_yr == "") $38 = "\\N"
    if (mod2_yr == "") $36 = "\\N"
    if (nfl_per == "") $27 = "\\N"
    if (moist_reg == "") $8 = "\\N"
    if (sp3_per == "") $16 = "\\N"
    if (polygon_number == "") $4 = "\\N"
    if (anth_veg == "") $29 = "\\N"
    if (sp4_per == "") $18 = "\\N"
    if (mod1_yr == "") $33 = "\\N"
    if (height == "") $10 = "\\N"
    if (company_plot_number == "") $2 = "\\N"
    if (struc == "") $21 = "\\N"
    if (sp5_per == "") $20 = "\\N"
    if (tpr == "") $24 = "\\N"
    if (struc_val == "") $22 = "\\N"
    if (company == "") $1 = "\\N"
    if (year_photography == "") $5 = "\\N"
    if (sp1 == "") $11 = "\\N"
    if (sp2 == "") $13 = "\\N"
    if (sp3 == "") $15 = "\\N"
    if (data == "") $37 = "\\N"
    if (sp4 == "") $17 = "\\N"
    if (sp5 == "") $19 = "\\N"
    if (year_photo_call == "") $6 = "\\N"
    if (anth_non == "") $30 = "\\N"
    if (nfl == "") $26 = "\\N"
    if (mod1_ext == "") $32 = "\\N"
    if (mod1 == "") $31 = "\\N"
    if (mod2 == "") $34 = "\\N"
    if (density == "") $9 = "\\N"
    if (layer_type == "") $7 = "\\N"
}

# action handlers
action == "insert" && NR == 1 {
    print "SET client_encoding = 'UTF8';"
    print "COPY " schema "photo_avi (" addfields FS "source_row_index" FS $0 ") FROM stdin;"
}
action == "insert" && NR > 1 {
   record = addvals "\t" NR
   for (i = 1; i <= NF; i++) {
       record = record "\t" $i
   }
   print record
}
action == "table" && NR == 1 {
     print "CREATE TABLE IF NOT EXISTS photo_avi (company ,company_plot_number ,avi_version ,polygon_number ,year_photography ,year_photo_call ,layer_type ,moist_reg ,density ,height ,sp1 ,sp1_per ,sp2 ,sp2_per ,sp3 ,sp3_per ,sp4 ,sp4_per ,sp5 ,sp5_per ,struc ,struc_val ,origin ,tpr ,initials ,nfl ,nfl_per ,nat_non ,anth_veg ,anth_non ,mod1 ,mod1_ext ,mod1_yr ,mod2 ,mod2_ext ,mod2_yr ,data ,data_yr ,photo_avi_layer_comment , CONSTRAINT photo_avi_pkey PRIMARY KEY (company,company_plot_number,polygon_number,year_photography,layer_type) , CONSTRAINT photo_avi_plot_fkey FOREIGN KEY (company,company_plot_number) REFERENCES plot (company,company_plot_number) MATCH FULL ON UPDATE CASCADE ON DELETE NO ACTION);"
}
action == "sanitize" { print }
# la fin
END {
    if (action == "validate:summary" && length(dupkeys) > 0) for (dup in dupkeys) { violation=CSVFILENAME FS "company|company_plot_number|polygon_number|year_photography|layer_type" FS  "duplicate" FS dup " violates pkey" FS "error"; violations[violation] = dupkeys[dup]}
    if (action == "validate:summary") { if (length(violations) > 0) for (violation in violations) { print violation FS violations[violation]; } }
    if (action == "insert") print "\\." RS
    if (action == "validate" && options["summary"] == "true") { print RS "violation summary: " RS "   counts:   " RS "      total: " err_count; print_cats(cats); }
}
